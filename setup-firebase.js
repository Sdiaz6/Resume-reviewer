#!/usr/bin/env node

/**
 * Firebase Setup Helper Script
 * This script helps you set up Firebase configuration interactively
 */

import readline from 'readline';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function question(prompt) {
  return new Promise((resolve) => {
    rl.question(prompt, resolve);
  });
}

async function setupFirebase() {
  console.log('\nüî• Firebase Setup Helper\n');
  console.log('This script will help you configure Firebase for your Resume Reviewer app.\n');
  console.log('üìã Steps to get your Firebase config:');
  console.log('1. Go to https://console.firebase.google.com/');
  console.log('2. Create a new project (or select existing)');
  console.log('3. Enable Authentication (Email/Password)');
  console.log('4. Create Firestore Database (test mode)');
  console.log('5. Go to Project Settings > Your apps > Web app');
  console.log('6. Copy your firebaseConfig object\n');
  
  const proceed = await question('Have you created your Firebase project? (y/n): ');
  
  if (proceed.toLowerCase() !== 'y') {
    console.log('\nüìñ Please follow the guide in FIREBASE_SETUP_GUIDE.md first.');
    console.log('Then run this script again.\n');
    rl.close();
    return;
  }

  console.log('\nüìù Please enter your Firebase configuration values:\n');
  
  const apiKey = await question('API Key: ');
  const authDomain = await question('Auth Domain (e.g., your-project.firebaseapp.com): ');
  const projectId = await question('Project ID: ');
  const storageBucket = await question('Storage Bucket (e.g., your-project.appspot.com): ');
  const messagingSenderId = await question('Messaging Sender ID: ');
  const appId = await question('App ID: ');

  const configContent = `// Firebase Configuration
// Auto-generated by setup-firebase.js
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';
import { getStorage } from 'firebase/storage';

const firebaseConfig = {
  apiKey: "${apiKey}",
  authDomain: "${authDomain}",
  projectId: "${projectId}",
  storageBucket: "${storageBucket}",
  messagingSenderId: "${messagingSenderId}",
  appId: "${appId}"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize Firebase services
export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);

export default app;
`;

  const configPath = path.join(__dirname, 'src', 'config', 'firebase.js');
  
  try {
    fs.writeFileSync(configPath, configContent, 'utf8');
    console.log('\n‚úÖ Firebase configuration saved successfully!');
    console.log(`üìÅ File: ${configPath}\n`);
    console.log('üöÄ Next steps:');
    console.log('1. Restart your dev server (npm run dev)');
    console.log('2. Test signup/login at /signup and /login');
    console.log('3. Make sure Authentication and Firestore are enabled in Firebase Console\n');
  } catch (error) {
    console.error('\n‚ùå Error saving configuration:', error.message);
  }

  rl.close();
}

setupFirebase();

